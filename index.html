<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCG HEIM HR System</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Prop-Types -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>

    <!-- Babel for JSX/TypeScript -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ed1c24', // SCG Red
                        primaryHover: '#c41219',
                        slate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 0 0 1px rgba(0,0,0,0.03), 0 2px 8px rgba(0,0,0,0.04)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8fafc; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="text-slate-600 antialiased">
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
        const { useState, useEffect, useMemo, useCallback } = React;
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip: RechartsTooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell, AreaChart, Area 
        } = Recharts;

        // --- ICON SYSTEM ---
        const IconBase = ({ size = 20, color = "currentColor", stroke = 2, children, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={stroke} strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        // Icons
        const LayoutDashboard = (p) => <IconBase {...p}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></IconBase>;
        const Users = (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const FileText = (p) => <IconBase {...p}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></IconBase>;
        const Settings = (p) => <IconBase {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Plus = (p) => <IconBase {...p}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Building2 = (p) => <IconBase {...p}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></IconBase>;
        const CalendarIcon = (p) => <IconBase {...p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconBase>;
        const Edit3 = (p) => <IconBase {...p}><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></IconBase>;
        const Save = (p) => <IconBase {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const Menu = (p) => <IconBase {...p}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></IconBase>;
        const CloseIcon = (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="M6 6 18 18"/></IconBase>;
        const UserPlus = (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></IconBase>;
        const User = (p) => <IconBase {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
        const Clock = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const AlertTriangle = (p) => <IconBase {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></IconBase>;
        const TrendingUp = (p) => <IconBase {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>;
        const UploadCloud = (p) => <IconBase {...p}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></IconBase>;
        const FileSpreadsheet = (p) => <IconBase {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></IconBase>;
        const Trash2 = (p) => <IconBase {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const Search = (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const Database = (p) => <IconBase {...p}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></IconBase>;
        const RefreshCw = (p) => <IconBase {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const FileJson = (p) => <IconBase {...p}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M10 12a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1"/><path d="M14 12a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1"/></IconBase>;
        const Activity = (p) => <IconBase {...p}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></IconBase>;
        const Stethoscope = (p) => <IconBase {...p}><path d="M4.8 2.3A.3.3 0 0 1 5 2h14a.3.3 0 0 1 .2.3v3.4a3 3 0 0 1-3 3v2.9a6 6 0 0 1-6 6 6 6 0 0 1-6-6v-2.9a3 3 0 0 1-3-3V2.3z"/><line x1="12" x2="12" y1="17" y2="22"/><circle cx="12" cy="19" r="2"/></IconBase>;
        const Download = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></IconBase>;
        const Check = (p) => <IconBase {...p}><polyline points="20 6 9 17 4 12"/></IconBase>;
        const LogIn = (p) => <IconBase {...p}><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></IconBase>;
        const Lock = (p) => <IconBase {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>;
        // Added missing LogOut icon
        const LogOut = (p) => <IconBase {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></IconBase>;
        const ChevronLeft = (p) => <IconBase {...p}><polyline points="15 18 9 12 15 6" /></IconBase>;
        const ChevronRight = (p) => <IconBase {...p}><polyline points="9 18 15 12 9 6" /></IconBase>;

        // --- Configuration ---
        const CURRENT_YEAR = new Date().getFullYear();
        const DEFAULT_QUOTA = 30;

        // --- Theme (Clean Version) ---
        const COLORS = ['#ed1c24', '#f87171', '#fbbf24', '#3b82f6', '#9ca3af'];

        // --- Mock Data ---
        const MOCK_PARTNERSHIPS = [
          { id: 101, name: 'หจก. HR' },
          { id: 102, name: 'แก้วเกรียงไกร' }
        ];

        const MOCK_EMPLOYEES = [
          { id: 201, name: 'คุณสมศรี (HR)', partnershipId: 101, position: 'HR Manager', quota: 30 },
          { id: 202, name: 'คุณอำนวย (HR)', partnershipId: 101, position: 'Recruiter', quota: 30 },
          { id: 203, name: 'นายช่างแก้ว', partnershipId: 102, position: 'หัวหน้าช่าง', quota: 45 }, 
          { id: 204, name: 'นายเกรียงไกร', partnershipId: 102, position: 'โฟร์แมน', quota: 30 },
          { id: 205, name: 'ช่างสมชาย', partnershipId: 102, position: 'ช่างทั่วไป', quota: 15 } 
        ];

        const MOCK_LEAVES = [
          { id: 301, empId: 201, type: 'พักร้อน', days: 2, date: `${CURRENT_YEAR}-11-15`, status: 'Approved', timestamp: new Date().toISOString() },
          { id: 302, empId: 203, type: 'ลาป่วย', days: 1, date: `${CURRENT_YEAR}-11-20`, status: 'Approved', timestamp: new Date().toISOString(), hasCertificate: true }
        ];

        const MOCK_ATTENDANCE = [
            { id: 401, empId: 203, date: `${CURRENT_YEAR}-11-02`, timeIn: '08:45', lateMinutes: 45 },
            { id: 402, empId: 203, date: `${CURRENT_YEAR}-11-03`, timeIn: '08:15', lateMinutes: 15 },
            { id: 403, empId: 204, date: `${CURRENT_YEAR}-11-02`, timeIn: '08:30', lateMinutes: 30 }
        ];

        // --- Helpers ---
        const formatDateThai = (dateString) => {
          if (!dateString) return '-';
          const date = new Date(dateString);
          return date.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
        };

        const getStatusBadge = (status) => {
          if (status === 'Approved') return <span className="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold bg-emerald-50 text-emerald-600"><CheckCircle size={14} /> อนุมัติแล้ว</span>;
          if (status === 'Pending') return <span className="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold bg-amber-50 text-amber-600"><Clock size={14} /> รออนุมัติ</span>;
          return <span className="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold bg-red-50 text-red-600"><CloseIcon size={14} /> ไม่อนุมัติ</span>;
        };

        const calculateLateMinutes = (timeIn) => {
            if (!timeIn) return 0;
            const [inH, inM] = timeIn.split(':').map(Number);
            const startH = 8, startM = 0; 
            const inMinutes = inH * 60 + inM;
            const startMinutes = startH * 60 + startM;
            return inMinutes > startMinutes ? inMinutes - startMinutes : 0;
        };

        // --- Clean UI Components ---

        const Card = ({ children, className = '' }) => (
          <div className={`bg-white rounded-2xl shadow-card p-6 ${className}`}>
            {children}
          </div>
        );

        const Button = ({ children, onClick, variant = 'primary', className = '', icon: Icon, size = 'md' }) => {
          const sizeClass = size === 'sm' ? "px-3 py-1.5 text-xs" : "px-5 py-2.5 text-sm";
          const variants = {
            primary: `bg-primary hover:bg-primaryHover text-white shadow-md shadow-red-200/50`,
            secondary: `bg-slate-100 hover:bg-slate-200 text-slate-700`,
            outline: `bg-white border border-slate-200 hover:border-slate-300 text-slate-700 hover:bg-slate-50`,
            success: `bg-emerald-600 hover:bg-emerald-700 text-white shadow-md shadow-emerald-200/50`,
            danger: `bg-white border border-red-100 text-red-600 hover:bg-red-50`,
            ghost: `bg-transparent hover:bg-slate-100 text-slate-500`
          };
          return (
            <button onClick={onClick} className={`${sizeClass} rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-2 active:scale-95 ${variants[variant]} ${className}`}>
              {Icon && <Icon size={size === 'sm' ? 14 : 18} strokeWidth={2} />}
              {children}
            </button>
          );
        };

        const Toast = ({ message, type, onClose }) => {
          useEffect(() => { const t = setTimeout(onClose, 3000); return () => clearTimeout(t); }, [onClose]);
          return (
            <div className={`fixed top-6 right-6 z-[100] flex items-center gap-4 px-6 py-4 rounded-2xl shadow-lg transform transition-all animate-in slide-in-from-right duration-500 bg-white border border-slate-100`}>
              <div className={`p-2 rounded-full ${type === 'success' ? 'bg-emerald-50 text-emerald-600' : 'bg-red-50 text-red-600'}`}>
                {type === 'success' ? <CheckCircle size={20} /> : <AlertTriangle size={20} />}
              </div>
              <div>
                  <p className={`text-sm font-bold ${type === 'success' ? 'text-emerald-900' : 'text-red-900'}`}>{type === 'success' ? 'สำเร็จ' : 'แจ้งเตือน'}</p>
                  <p className="text-sm text-slate-500">{message}</p>
              </div>
              <button onClick={onClose} className="ml-2 hover:bg-slate-100 p-1 rounded-full text-slate-400"><CloseIcon size={16} /></button>
            </div>
          );
        };

        const NavItem = ({ active, onClick, icon: Icon, label }) => (
          <button onClick={onClick} className={`w-full flex items-center gap-3.5 px-4 py-3.5 rounded-xl transition-all duration-200 font-medium text-sm mb-1 ${active ? 'bg-red-50 text-primary' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-800'}`}>
            <Icon size={20} strokeWidth={active ? 2.5 : 2} />
            <span>{label}</span>
          </button>
        );

        // --- Login View ---
        const LoginView = ({ onLogin }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                // Simple hardcoded auth for demo
                if (username === 'admin' && password === '1234') {
                    onLogin('super_admin');
                } else if (username === 'hr' && password === '1234') {
                    onLogin('staff_hr');
                } else if (username === 'kaew' && password === '1234') {
                    onLogin('staff_kk');
                } else {
                    setError('ชื่อผู้ใช้งานหรือรหัสผ่านไม่ถูกต้อง');
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-50 p-6 animate-fade-in relative overflow-hidden">
                    {/* Background decoration */}
                    <div className="absolute top-[-10%] right-[-5%] w-[500px] h-[500px] bg-red-50 rounded-full blur-3xl opacity-60 pointer-events-none"></div>
                    <div className="absolute bottom-[-10%] left-[-10%] w-[600px] h-[600px] bg-slate-100 rounded-full blur-3xl opacity-60 pointer-events-none"></div>

                    <div className="w-full max-w-md bg-white rounded-3xl shadow-soft p-10 relative z-10 border border-slate-100">
                        <div className="text-center mb-8">
                            <div className="w-16 h-16 bg-primary rounded-2xl flex items-center justify-center text-white font-bold text-3xl mx-auto shadow-lg shadow-red-200 mb-4">S</div>
                            <h1 className="text-2xl font-extrabold text-slate-800">SCG HEIM <span className="text-primary">HR</span></h1>
                            <p className="text-slate-400 text-sm mt-2">เข้าสู่ระบบเพื่อจัดการข้อมูลพนักงาน</p>
                        </div>

                        <form onSubmit={handleLogin} className="space-y-5">
                            <div className="space-y-1.5">
                                <label className="text-xs font-bold text-slate-500 uppercase ml-1">ชื่อผู้ใช้งาน</label>
                                <div className="relative">
                                    <div className="absolute left-4 top-3.5 text-slate-400"><User size={18}/></div>
                                    <input 
                                        type="text" 
                                        className="w-full pl-11 pr-4 py-3 bg-slate-50 border-none rounded-xl text-sm font-medium outline-none focus:ring-2 focus:ring-primary/20 transition-all placeholder-slate-400"
                                        placeholder="Username"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                    />
                                </div>
                            </div>
                            <div className="space-y-1.5">
                                <label className="text-xs font-bold text-slate-500 uppercase ml-1">รหัสผ่าน</label>
                                <div className="relative">
                                    <div className="absolute left-4 top-3.5 text-slate-400"><Lock size={18}/></div>
                                    <input 
                                        type="password" 
                                        className="w-full pl-11 pr-4 py-3 bg-slate-50 border-none rounded-xl text-sm font-medium outline-none focus:ring-2 focus:ring-primary/20 transition-all placeholder-slate-400"
                                        placeholder="Password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                    />
                                </div>
                            </div>

                            {error && <div className="p-3 bg-red-50 text-red-600 text-xs rounded-lg text-center font-medium animate-slide-up">{error}</div>}

                            <button type="submit" className="w-full py-3.5 bg-primary hover:bg-primaryHover text-white rounded-xl font-bold shadow-lg shadow-red-200 transform active:scale-[0.98] transition-all flex justify-center items-center gap-2 mt-4">
                                <LogIn size={18} /> เข้าสู่ระบบ
                            </button>
                        </form>

                        <div className="mt-8 text-center border-t border-slate-50 pt-6">
                            <p className="text-xs text-slate-400">Demo Accounts:</p>
                            <div className="flex justify-center gap-3 mt-2">
                                <span className="px-2 py-1 bg-slate-50 rounded text-[10px] text-slate-500 border border-slate-100">admin / 1234</span>
                                <span className="px-2 py-1 bg-slate-50 rounded text-[10px] text-slate-500 border border-slate-100">hr / 1234</span>
                                <span className="px-2 py-1 bg-slate-50 rounded text-[10px] text-slate-500 border border-slate-100">kaew / 1234</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Sub-Views ---

        // NEW: Calendar Component
        const CalendarWidget = ({ leaveRecords, employees }) => {
            const [currentDate, setCurrentDate] = useState(new Date());

            const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
            const firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay(); // 0 = Sunday

            const prevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
            const nextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));
            const today = new Date();

            const getLeaveColor = (type) => {
                switch(type) {
                    case 'ลาป่วย': return 'bg-red-50 text-red-600 border-red-100';
                    case 'ลากิจ': return 'bg-blue-50 text-blue-600 border-blue-100';
                    case 'พักร้อน': return 'bg-amber-50 text-amber-600 border-amber-100';
                    default: return 'bg-slate-50 text-slate-500 border-slate-100';
                }
            };

            // Generate days
            const days = [];
            for (let i = 0; i < firstDayOfMonth; i++) {
                days.push(<div key={`empty-${i}`} className="min-h-[120px] bg-slate-50/50 border-b border-r border-slate-100"></div>);
            }
            for (let d = 1; d <= daysInMonth; d++) {
                const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const isToday = today.getDate() === d && today.getMonth() === currentDate.getMonth() && today.getFullYear() === currentDate.getFullYear();
                
                const daysLeaves = leaveRecords.filter(r => r.date === dateStr && r.status === 'Approved');

                days.push(
                    <div key={d} className={`min-h-[120px] p-2 border-b border-r border-slate-100 transition-colors hover:bg-slate-50 relative group ${isToday ? 'bg-red-50/20' : 'bg-white'}`}>
                        <div className="flex justify-between items-start mb-2">
                            <span className={`text-sm font-semibold w-7 h-7 flex items-center justify-center rounded-full ${isToday ? 'bg-primary text-white shadow-md' : 'text-slate-600'}`}>
                                {d}
                            </span>
                        </div>
                        <div className="space-y-1">
                            {daysLeaves.map((l, idx) => {
                                const emp = employees.find(e => e.id === l.empId);
                                return (
                                    <div key={idx} className={`text-[10px] px-2 py-1 rounded-md border truncate font-medium ${getLeaveColor(l.type)}`} title={`${emp?.name} - ${l.type}`}>
                                        <span className="opacity-70 mr-1">•</span>
                                        {emp?.name.split(' ')[0]}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            }

            return (
                <Card className="p-0 overflow-hidden border-none shadow-card">
                    <div className="flex items-center justify-between p-6 border-b border-slate-100 bg-white">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-red-50 rounded-xl flex items-center justify-center text-primary"><CalendarIcon size={20}/></div>
                            <h3 className="text-xl font-bold text-slate-800">
                                {currentDate.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' })}
                            </h3>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={prevMonth} className="w-9 h-9 flex items-center justify-center hover:bg-slate-100 rounded-xl text-slate-500 transition-colors border border-slate-200"><ChevronLeft size={18} /></button>
                            <button onClick={() => setCurrentDate(new Date())} className="px-4 py-1 text-xs font-bold text-primary bg-red-50 rounded-xl hover:bg-red-100 transition-colors border border-red-100">วันนี้</button>
                            <button onClick={nextMonth} className="w-9 h-9 flex items-center justify-center hover:bg-slate-100 rounded-xl text-slate-500 transition-colors border border-slate-200"><ChevronRight size={18} /></button>
                        </div>
                    </div>
                    <div className="grid grid-cols-7 border-b border-slate-100 bg-slate-50 text-slate-400 text-[11px] font-bold uppercase tracking-wider text-center py-3">
                        <div>อาทิตย์</div><div>จันทร์</div><div>อังคาร</div><div>พุธ</div><div>พฤหัส</div><div>ศุกร์</div><div>เสาร์</div>
                    </div>
                    <div className="grid grid-cols-7 bg-slate-100 border-l border-t border-slate-100">
                        {days}
                    </div>
                </Card>
            );
        };

        const DashboardView = ({ stats, chartData, filteredRecords, topLeavers, lateStats, dateFilter, setDateFilter, dashboardTab, setDashboardTab, handleExportCSV, searchTerm, setSearchTerm, handleDeleteLeave, role, partnerships, selectedPartnershipId, setSelectedPartnershipId, employees, leaveRecords }) => (
          <div className="space-y-8 animate-fade-in pb-10">
              {/* Header Section */}
              <div className="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                <div>
                  <h2 className="text-3xl font-bold text-slate-900 tracking-tight">ภาพรวมการลา</h2>
                  <div className="flex items-center gap-3 mt-2">
                     <span className="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[11px] font-bold uppercase tracking-wider bg-slate-100 text-slate-600">
                        <span className="w-1.5 h-1.5 rounded-full bg-emerald-500"></span> Online
                     </span>
                     <span className="text-slate-300">|</span>
                     <span className="text-sm text-slate-500">ข้อมูลล่าสุด: {new Date().toLocaleDateString('th-TH')}</span>
                  </div>
                </div>
                
                <div className="flex flex-wrap gap-3 w-full lg:w-auto items-center">
                   <div className="flex items-center gap-3 bg-white pl-4 pr-2 py-2 rounded-xl shadow-card min-w-[220px]">
                      <CalendarIcon size={18} className="text-slate-400" />
                      <select className="bg-transparent outline-none text-slate-700 font-medium text-sm w-full py-1 cursor-pointer" value={dateFilter} onChange={(e) => setDateFilter(e.target.value)}>
                        <option value="all">ทั้งหมด</option>
                        <option value="this_year">ปีนี้ ({CURRENT_YEAR})</option>
                        <option value="this_month">เดือนนี้</option>
                      </select>
                   </div>
                   
                   <div className="flex bg-white p-1 rounded-xl shadow-card">
                     <button onClick={() => setDashboardTab('overview')} className={`px-4 py-2 text-sm font-medium rounded-lg transition-all ${dashboardTab === 'overview' ? 'bg-slate-100 text-slate-900' : 'text-slate-400 hover:text-slate-600'}`}>ภาพรวม</button>
                     <button onClick={() => setDashboardTab('stats')} className={`px-4 py-2 text-sm font-medium rounded-lg transition-all ${dashboardTab === 'stats' ? 'bg-slate-100 text-slate-900' : 'text-slate-400 hover:text-slate-600'}`}>สถิติ</button>
                     <button onClick={() => setDashboardTab('calendar')} className={`px-4 py-2 text-sm font-medium rounded-lg transition-all ${dashboardTab === 'calendar' ? 'bg-slate-100 text-slate-900' : 'text-slate-400 hover:text-slate-600'}`}>ปฏิทิน</button>
                   </div>

                   {role === 'super_admin' && (
                     <div className="flex items-center gap-3 bg-white pl-4 pr-2 py-2 rounded-xl shadow-card min-w-[200px]">
                      <Building2 size={18} className="text-slate-400" />
                      <select className="bg-transparent outline-none text-slate-700 font-medium text-sm w-full py-1 cursor-pointer" value={selectedPartnershipId} onChange={(e) => setSelectedPartnershipId(e.target.value)}>
                        <option value="all">ทุกหน่วยงาน</option>
                        {partnerships.map((p) => <option key={p.id} value={p.id}>{p.name}</option>)}
                      </select>
                     </div>
                   )}
                   
                   <button onClick={handleExportCSV} className="p-3 bg-white rounded-xl shadow-card text-slate-500 hover:text-primary transition-colors">
                        <Download size={20} />
                   </button>
                </div>
              </div>

              {dashboardTab === 'overview' && (
                <>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <Card className="flex flex-col justify-between h-40 relative overflow-hidden group">
                        <div className="absolute right-0 top-0 w-32 h-32 bg-red-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                        <div className="relative z-10">
                            <p className="text-slate-500 text-sm font-medium mb-1">วันลาอนุมัติแล้ว</p>
                            <h3 className="text-5xl font-bold text-slate-800">{stats.totalLeaves}</h3>
                        </div>
                        <div className="relative z-10 flex items-center gap-2 text-red-600 text-xs font-bold uppercase tracking-wider">
                            <span>TOTAL LEAVES</span>
                        </div>
                    </Card>
                    
                    <Card className="flex flex-col justify-between h-40 relative overflow-hidden group">
                        <div className="absolute right-0 top-0 w-32 h-32 bg-indigo-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                        <div className="relative z-10">
                            <p className="text-slate-500 text-sm font-medium mb-1">ลาป่วยสะสม</p>
                            <h3 className="text-5xl font-bold text-slate-800">{stats.sickLeaves}</h3>
                        </div>
                        <div className="relative z-10 text-indigo-600 text-xs font-bold uppercase tracking-wider">
                            SICK LEAVES
                        </div>
                    </Card>

                    <Card className="flex flex-col justify-between h-40 relative overflow-hidden group">
                        <div className="absolute right-0 top-0 w-32 h-32 bg-amber-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                        <div className="relative z-10">
                            <p className="text-slate-500 text-sm font-medium mb-1">พักร้อนสะสม</p>
                            <h3 className="text-5xl font-bold text-slate-800">{stats.vacationLeaves}</h3>
                        </div>
                        <div className="relative z-10 text-amber-600 text-xs font-bold uppercase tracking-wider">
                            VACATION
                        </div>
                    </Card>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <Card className="lg:col-span-2">
                        <div className="flex justify-between items-center mb-8">
                            <h3 className="text-lg font-bold text-slate-800">รายการลาล่าสุด</h3>
                            <div className="relative w-64">
                                <Search className="absolute left-3 top-2.5 text-slate-400" size={16} />
                                <input type="text" placeholder="ค้นหา..." className="w-full pl-9 pr-4 py-2 bg-slate-50 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-red-100 transition-all placeholder-slate-400" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                            </div>
                        </div>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left border-collapse">
                                <thead>
                                    <tr className="text-slate-400 text-[11px] font-bold uppercase tracking-wider border-b border-slate-100">
                                        <th className="pb-4 pl-2">วันที่</th>
                                        <th className="pb-4">พนักงาน</th>
                                        <th className="pb-4">ประเภท</th>
                                        <th className="pb-4 text-center">จำนวน</th>
                                        <th className="pb-4 text-center">สถานะ</th>
                                        <th className="pb-4 text-right pr-2">Action</th>
                                    </tr>
                                </thead>
                                <tbody className="text-sm text-slate-600">
                                    {filteredRecords.sort((a, b) => (b.date > a.date ? 1 : -1)).slice(0, 5).map((record) => {
                                        const emp = employees.find((e) => e.id === record.empId);
                                        return (
                                            <tr key={record.id} className="group hover:bg-slate-50/50 transition-colors border-b border-slate-50 last:border-none">
                                                <td className="py-4 pl-2 font-medium text-slate-500">{formatDateThai(record.date)}</td>
                                                <td className="py-4">
                                                    <div className="font-semibold text-slate-800">{emp?.name || 'Unknown'}</div>
                                                    <div className="text-xs text-slate-400">{partnerships.find((p) => p.id === emp?.partnershipId)?.name}</div>
                                                </td>
                                                <td className="py-4">
                                                    <span className="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-xs font-medium bg-slate-50 text-slate-600">
                                                        {record.type}
                                                        {record.hasCertificate && <Stethoscope size={12} className="text-primary" />}
                                                    </span>
                                                </td>
                                                <td className="py-4 text-center font-bold text-slate-700">{record.days}</td>
                                                <td className="py-4 text-center">{getStatusBadge(record.status)}</td>
                                                <td className="py-4 text-right pr-2">
                                                    <button onClick={() => { if(confirm('ลบรายการ?')) handleDeleteLeave(record.id); }} className="p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all opacity-0 group-hover:opacity-100"><Trash2 size={16} /></button>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                    {filteredRecords.length === 0 && <tr><td colSpan={6} className="py-8 text-center text-slate-400">ไม่พบข้อมูล</td></tr>}
                                </tbody>
                            </table>
                        </div>
                    </Card>

                    <Card>
                      <h3 className="text-lg font-bold text-slate-800 mb-6">สัดส่วนการลา</h3>
                      <div className="h-64 w-full relative">
                        <ResponsiveContainer width="100%" height="100%">
                          <PieChart>
                            <Pie data={chartData} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
                              {chartData.map((entry, index) => (<Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} stroke="transparent" />))}
                            </Pie>
                            <RechartsTooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 4px 20px rgba(0,0,0,0.1)' }} />
                            <Legend verticalAlign="bottom" iconType="circle" iconSize={8} />
                          </PieChart>
                        </ResponsiveContainer>
                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div className="text-center">
                                <span className="block text-3xl font-bold text-slate-800">{stats.totalLeaves}</span>
                                <span className="text-xs text-slate-400 uppercase tracking-wide">Total</span>
                            </div>
                        </div>
                      </div>
                    </Card>
                  </div>
                </>
              )}

              {dashboardTab === 'stats' && (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                   <Card>
                     <div className="flex items-center gap-4 mb-8">
                        <div className="w-12 h-12 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center"><TrendingUp size={24} /></div>
                        <div>
                            <h3 className="font-bold text-lg text-slate-800">Top 10 ลาสูงสุด</h3>
                            <p className="text-sm text-slate-400">พนักงานที่ใช้วันลามากที่สุด</p>
                        </div>
                     </div>
                     <div className="overflow-hidden">
                       <table className="w-full text-sm text-left border-collapse">
                         <thead><tr className="text-slate-400 text-xs font-bold uppercase tracking-wider border-b border-slate-100"><th className="pb-3 pl-4">#</th><th className="pb-3">พนักงาน</th><th className="text-right pb-3 pr-4">วันลา</th></tr></thead>
                         <tbody className="text-slate-600">
                           {topLeavers.slice(0,10).map((item, idx) => (
                              <tr key={idx} className="hover:bg-slate-50/50 border-b border-slate-50 last:border-none">
                                 <td className="py-3 pl-4"><span className={`inline-flex items-center justify-center w-6 h-6 rounded-full text-[10px] font-bold text-white ${idx < 3 ? 'bg-amber-400 shadow-sm shadow-amber-200' : 'bg-slate-200'}`}>{idx+1}</span></td>
                                 <td className="py-3 font-medium text-slate-700">{item.employee?.name}</td>
                                 <td className="py-3 text-right pr-4 font-bold text-slate-800">{item.days}</td>
                              </tr>
                           ))}
                         </tbody>
                       </table>
                     </div>
                   </Card>
                   
                   <Card>
                     <div className="flex items-center gap-4 mb-8">
                        <div className="w-12 h-12 bg-amber-50 text-amber-600 rounded-2xl flex items-center justify-center"><Clock size={24} /></div>
                        <div>
                            <h3 className="font-bold text-lg text-slate-800">สถิติมาสาย</h3>
                            <p className="text-sm text-slate-400">บันทึกการเข้างานล่าช้า</p>
                        </div>
                     </div>
                     <div className="overflow-hidden">
                        <table className="w-full text-sm text-left border-collapse">
                           <thead><tr className="text-slate-400 text-xs font-bold uppercase tracking-wider border-b border-slate-100"><th className="pb-3 pl-4">พนักงาน</th><th className="pb-3">วันที่</th><th className="text-right pb-3 pr-4">สาย (นาที)</th></tr></thead>
                           <tbody className="text-slate-600">
                              {lateStats.length > 0 ? lateStats.map((r, i) => (
                                    <tr key={i} className="hover:bg-slate-50/50 border-b border-slate-50 last:border-none">
                                       <td className="py-3 pl-4 font-medium text-slate-700">{r.employee?.name}</td>
                                       <td className="py-3 text-slate-500">{formatDateThai(r.date)} <span className="text-[10px] bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 ml-1 font-mono">{r.timeIn}</span></td>
                                       <td className="py-3 text-right pr-4 font-bold text-red-500">+{r.lateMinutes}</td>
                                    </tr>
                                 )) : <tr><td colSpan={3} className="py-8 text-center text-slate-400">ไม่มีข้อมูลการมาสาย</td></tr>}
                           </tbody>
                        </table>
                     </div>
                   </Card>
                </div>
              )}

              {dashboardTab === 'calendar' && (
                <CalendarWidget leaveRecords={leaveRecords} employees={employees} />
              )}
          </div>
        );

        const EntryView = ({ role, partnerships, employees, leaveRecords, newLeave, setNewLeave, handleAddLeave, getEmpUsage, handleDeleteLeave, getEmpQuota }) => {
            let activePid = 101; 
            if (role === 'staff_kk') activePid = 102;
            
            const partnerName = partnerships.find((p) => p.id === activePid)?.name;
            const activeEmps = employees.filter((e) => e.partnershipId === activePid);
            const myHistory = leaveRecords.filter((r) => activeEmps.some((e) => e.id === r.empId)).sort((a, b) => (b.date > a.date ? 1 : -1)).slice(0, 5);
            
            const currentQuota = newLeave.empId ? getEmpQuota(Number(newLeave.empId)) : DEFAULT_QUOTA;

            return (
              <div className="max-w-lg mx-auto animate-fade-in pb-20">
                 <div className="text-center mb-10">
                    <h2 className="text-3xl font-bold text-slate-800 tracking-tight">บันทึกการลา</h2>
                    <div className="mt-3 inline-flex items-center gap-2 px-4 py-1.5 bg-white rounded-full shadow-sm border border-slate-100">
                       <span className="w-2 h-2 rounded-full bg-primary animate-pulse"></span>
                       <span className="text-sm font-medium text-slate-600">หน่วยงาน: <span className="text-slate-900 font-bold">{partnerName}</span></span>
                    </div>
                 </div>

                 <Card className="overflow-hidden border-none shadow-soft mb-8">
                    <form onSubmit={handleAddLeave} className="space-y-6">
                       <div className="space-y-1.5">
                          <label className="text-xs font-bold text-slate-500 uppercase tracking-wide ml-1">ชื่อพนักงาน</label>
                          <div className="relative">
                              <select required className="w-full p-3.5 bg-slate-50 border-none rounded-xl focus:ring-2 focus:ring-primary/20 text-slate-700 font-medium appearance-none cursor-pointer transition-all hover:bg-slate-100" value={newLeave.empId} onChange={e => setNewLeave({...newLeave, empId: e.target.value})}>
                                 <option value="">-- เลือกรายชื่อ --</option>
                                 {activeEmps.map((e) => <option key={e.id} value={e.id}>{e.name}</option>)}
                              </select>
                              <div className="absolute right-4 top-4 text-slate-400 pointer-events-none"><User size={18} /></div>
                          </div>
                       </div>

                       {newLeave.empId && (
                          <div className="bg-slate-50 p-5 rounded-2xl border border-slate-100/50">
                             <div className="flex justify-between items-end mb-3">
                                <span className="text-xs font-bold text-slate-400 uppercase tracking-wide">โควตาคงเหลือ</span>
                                <div className="text-right">
                                    <span className="text-2xl font-bold text-slate-800">{currentQuota - getEmpUsage(Number(newLeave.empId))}</span>
                                    <span className="text-slate-400 text-xs ml-1 font-medium">/ {currentQuota} วัน</span>
                                </div>
                             </div>
                             <div className="w-full bg-slate-200 h-2 rounded-full overflow-hidden">
                                <div className="h-full rounded-full bg-emerald-500 shadow-sm transition-all duration-1000" style={{ width: `${Math.min((getEmpUsage(Number(newLeave.empId))/currentQuota)*100, 100)}%` }}></div>
                             </div>
                          </div>
                       )}

                       <div className="grid grid-cols-2 gap-5">
                          <div className="space-y-1.5">
                             <label className="text-xs font-bold text-slate-500 uppercase tracking-wide ml-1">ประเภท</label>
                             <select className="w-full p-3.5 bg-slate-50 border-none rounded-xl focus:ring-2 focus:ring-primary/20 text-slate-700 outline-none" value={newLeave.type} onChange={e => setNewLeave({...newLeave, type: e.target.value})}>
                                <option>ลากิจ</option><option>ลาป่วย</option><option>พักร้อน</option><option>อื่นๆ</option>
                             </select>
                          </div>
                          <div className="space-y-1.5">
                             <label className="text-xs font-bold text-slate-500 uppercase tracking-wide ml-1">จำนวนวัน</label>
                             <input type="number" step="0.5" className="w-full p-3.5 bg-slate-50 border-none rounded-xl focus:ring-2 focus:ring-primary/20 text-slate-700 outline-none text-center font-bold" value={newLeave.days} onChange={e => setNewLeave({...newLeave, days: e.target.value})} />
                          </div>
                       </div>
                       
                       {newLeave.type === 'ลาป่วย' && (
                          <label className="flex items-center gap-3 p-4 bg-red-50/50 rounded-xl border border-red-50 cursor-pointer hover:bg-red-50 transition-colors">
                              <input type="checkbox" className="w-5 h-5 text-primary rounded border-gray-300 focus:ring-primary" checked={newLeave.hasCertificate || false} onChange={e => setNewLeave({...newLeave, hasCertificate: e.target.checked})} />
                              <span className="text-sm font-medium text-red-800 flex items-center gap-2"><Stethoscope size={18}/> มีใบรับรองแพทย์</span>
                          </label>
                       )}

                       <div className="space-y-1.5">
                          <label className="text-xs font-bold text-slate-500 uppercase tracking-wide ml-1">วันที่ลา</label>
                          <input type="date" required className="w-full p-3.5 bg-slate-50 border-none rounded-xl focus:ring-2 focus:ring-primary/20 text-slate-700 outline-none font-medium" value={newLeave.date} onChange={e => setNewLeave({...newLeave, date: e.target.value})} />
                       </div>

                       <button type="submit" className="w-full py-4 bg-primary hover:bg-primaryHover text-white rounded-2xl font-bold shadow-lg shadow-red-200 transform active:scale-[0.98] transition-all flex justify-center items-center gap-2 text-lg">
                          <Save size={20} /> ยืนยันข้อมูล
                       </button>
                    </form>
                 </Card>

                 <div className="pl-2">
                    <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">รายการล่าสุดของฉัน</h3>
                    <div className="space-y-3">
                       {myHistory.map((r) => (
                          <div key={r.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center group">
                             <div className="flex items-center gap-4">
                                <div className={`w-12 h-12 rounded-2xl flex items-center justify-center font-bold text-lg shadow-sm ${r.type === 'ลาป่วย' ? 'bg-indigo-50 text-indigo-500' : 'bg-amber-50 text-amber-500'}`}>
                                   {r.type === 'ลาป่วย' ? 'S' : 'L'}
                                </div>
                                <div>
                                   <p className="font-bold text-slate-700 text-sm">{formatDateThai(r.date)}</p>
                                   <p className="text-xs text-slate-400 flex items-center gap-1 mt-0.5">
                                       {employees.find((e) => e.id === r.empId)?.name}
                                       {r.hasCertificate && <Stethoscope size={12} className="text-primary" />}
                                   </p>
                                </div>
                             </div>
                             <div className="flex items-center gap-3">
                                {getStatusBadge(r.status)}
                                <button onClick={() => handleDeleteLeave(r.id)} className="w-8 h-8 flex items-center justify-center rounded-lg text-slate-300 hover:text-red-500 hover:bg-red-50 transition-all opacity-0 group-hover:opacity-100"><Trash2 size={16} /></button>
                             </div>
                          </div>
                       ))}
                    </div>
                 </div>
              </div>
            );
        };

        const SettingsView = ({ partnerships, employees, handleGenerateData, handleResetSystem, handleExportJSON, handleUpdatePartnershipName, handleAddEmployee, handleUpdateEmployee, handleDeleteEmployee, editingName, setEditingName, newEmp, setNewEmp, editingEmployee, setEditingEmployee, handleImportAttendance, employeeSearch, setEmployeeSearch, filteredEmployeesSettings }) => (
            <div className="space-y-8 animate-fade-in max-w-5xl mx-auto pb-10">
              <div className="flex justify-between items-end border-b border-slate-200 pb-6">
                 <div>
                    <h2 className="text-3xl font-bold text-slate-900">ตั้งค่าระบบ</h2>
                    <p className="text-slate-500 mt-1">จัดการข้อมูลพนักงานและโครงสร้างองค์กร</p>
                 </div>
                 <div className="flex gap-2">
                    <Button onClick={handleGenerateData} variant="success" size="sm" icon={Database}>Load Demo</Button>
                    <Button onClick={handleExportJSON} variant="outline" size="sm" icon={FileJson}>Backup</Button>
                 </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                 <Card>
                    <div className="flex items-center gap-3 mb-6">
                        <div className="p-2 bg-red-50 text-primary rounded-lg"><Building2 size={20}/></div>
                        <h3 className="font-bold text-lg text-slate-800">รายชื่อหน่วยงาน</h3>
                    </div>
                    <div className="space-y-3">
                       {partnerships.map((p) => (
                          <div key={p.id} className="flex justify-between items-center p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors group">
                             {editingName.id === p.id ? (
                                <div className="flex gap-2 w-full">
                                   <input className="flex-1 p-2 bg-white border border-slate-200 rounded-lg text-sm outline-none focus:border-primary" value={editingName.name} onChange={e => setEditingName({...editingName, name: e.target.value})} autoFocus />
                                   <button onClick={() => handleUpdatePartnershipName(p.id)} className="w-9 h-9 flex items-center justify-center bg-emerald-50 text-emerald-600 rounded-lg hover:bg-emerald-100"><Check size={16}/></button>
                                </div>
                             ) : (
                                <>
                                   <span className="font-medium text-slate-700">{p.name}</span>
                                   <button onClick={() => setEditingName({ id: p.id, name: p.name })} className="text-slate-400 hover:text-primary p-2 opacity-0 group-hover:opacity-100 transition-all"><Edit3 size={16} /></button>
                                </>
                             )}
                          </div>
                       ))}
                    </div>
                 </Card>

                 <Card>
                    <div className="flex items-center gap-3 mb-6">
                        <div className="p-2 bg-indigo-50 text-indigo-600 rounded-lg"><UploadCloud size={20}/></div>
                        <h3 className="font-bold text-lg text-slate-800">นำเข้าเวลาเข้างาน</h3>
                    </div>
                    <label className="flex flex-col items-center justify-center gap-4 p-8 border-2 border-dashed border-slate-200 rounded-2xl cursor-pointer hover:border-primary/50 hover:bg-slate-50 transition-all group h-full">
                       <div className="w-16 h-16 bg-white rounded-full shadow-sm flex items-center justify-center text-slate-400 group-hover:text-primary group-hover:scale-110 transition-all"><FileSpreadsheet size={32} /></div>
                       <div className="text-center">
                          <p className="font-bold text-slate-700">คลิกเพื่ออัปโหลดไฟล์</p>
                          <p className="text-xs text-slate-400 mt-1">รองรับไฟล์ .CSV เท่านั้น</p>
                       </div>
                       <input type="file" className="hidden" accept=".csv" onChange={handleImportAttendance} />
                    </label>
                 </Card>
              </div>

              <Card>
                 <div className="flex items-center gap-3 mb-6">
                    <div className="p-2 bg-amber-50 text-amber-600 rounded-lg"><UserPlus size={20} /></div>
                    <h3 className="font-bold text-lg text-slate-800">จัดการข้อมูลพนักงาน</h3>
                 </div>
                 
                 <div className="bg-slate-50/80 p-6 rounded-2xl mb-8 border border-slate-100">
                     <form onSubmit={editingEmployee ? handleUpdateEmployee : handleAddEmployee} className="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                       <div className="md:col-span-3">
                           <label className="text-xs font-bold text-slate-500 uppercase ml-1 mb-1 block">ชื่อ-นามสกุล</label>
                           <input required className="w-full p-2.5 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all" value={editingEmployee ? editingEmployee.name : newEmp.name} onChange={e => editingEmployee ? setEditingEmployee({...editingEmployee, name: e.target.value}) : setNewEmp({...newEmp, name: e.target.value})} placeholder="ระบุชื่อ..." />
                       </div>
                       <div className="md:col-span-3">
                           <label className="text-xs font-bold text-slate-500 uppercase ml-1 mb-1 block">ตำแหน่ง</label>
                           <input className="w-full p-2.5 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all" value={editingEmployee ? editingEmployee.position : newEmp.position} onChange={e => editingEmployee ? setEditingEmployee({...editingEmployee, position: e.target.value}) : setNewEmp({...newEmp, position: e.target.value})} placeholder="ระบุตำแหน่ง..." />
                       </div>
                       <div className="md:col-span-3">
                           <label className="text-xs font-bold text-slate-500 uppercase ml-1 mb-1 block">สังกัด</label>
                           <select required className="w-full p-2.5 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all" value={editingEmployee ? editingEmployee.partnershipId : newEmp.partnershipId} onChange={e => editingEmployee ? setEditingEmployee({...editingEmployee, partnershipId: Number(e.target.value)}) : setNewEmp({...newEmp, partnershipId: e.target.value})}>
                               <option value="">เลือกสังกัด</option>{partnerships.map((p) => <option key={p.id} value={p.id}>{p.name}</option>)}
                           </select>
                       </div>
                       <div className="md:col-span-1">
                           <label className="text-xs font-bold text-slate-500 uppercase ml-1 mb-1 block">โควตา</label>
                           <input type="number" className="w-full p-2.5 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none text-center" value={editingEmployee ? (editingEmployee.quota || DEFAULT_QUOTA) : (newEmp.quota || DEFAULT_QUOTA)} onChange={e => editingEmployee ? setEditingEmployee({...editingEmployee, quota: Number(e.target.value)}) : setNewEmp({...newEmp, quota: Number(e.target.value)})} />
                       </div>
                       <div className="md:col-span-2 flex gap-2">
                         {editingEmployee ? 
                            <><Button variant="primary" className="flex-1 h-[42px]" icon={Save}>บันทึก</Button><Button variant="ghost" className="h-[42px] px-2" onClick={() => setEditingEmployee(null)}><CloseIcon size={18}/></Button></> 
                            : <Button variant="primary" className="w-full h-[42px]" icon={Plus}>เพิ่ม</Button>
                         }
                       </div>
                     </form>
                 </div>

                 <div>
                    <div className="flex justify-between items-center mb-4">
                        <div className="text-sm font-bold text-slate-400 uppercase tracking-wider">รายชื่อทั้งหมด ({filteredEmployeesSettings.length})</div>
                        <div className="relative w-64">
                            <Search className="absolute left-3 top-2.5 text-slate-400" size={16} />
                            <input type="text" placeholder="ค้นหาชื่อ..." className="w-full pl-9 pr-4 py-2 bg-slate-50 rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary/20 transition-all" value={employeeSearch} onChange={(e) => setEmployeeSearch(e.target.value)} />
                        </div>
                    </div>
                    <div className="overflow-hidden rounded-xl border border-slate-100">
                       <table className="w-full text-left text-sm border-collapse">
                          <thead><tr className="bg-slate-50 text-slate-500 font-semibold text-xs uppercase"><th className="px-4 py-3 border-b border-slate-100">ชื่อ-นามสกุล</th><th className="px-4 py-3 border-b border-slate-100">ตำแหน่ง</th><th className="px-4 py-3 border-b border-slate-100">สังกัด</th><th className="px-4 py-3 text-center border-b border-slate-100">โควตา</th><th className="px-4 py-3 text-right border-b border-slate-100">จัดการ</th></tr></thead>
                          <tbody className="divide-y divide-slate-50">
                             {filteredEmployeesSettings.map((emp) => (
                                <tr key={emp.id} className="hover:bg-slate-50/50 group transition-colors">
                                   <td className="px-4 py-3 font-medium text-slate-800">{emp.name}</td>
                                   <td className="px-4 py-3 text-slate-500">{emp.position}</td>
                                   <td className="px-4 py-3 text-slate-500">{partnerships.find((p) => p.id === emp.partnershipId)?.name}</td>
                                   <td className="px-4 py-3 text-center"><span className="px-2 py-0.5 bg-slate-100 rounded text-xs font-bold text-slate-600">{emp.quota || DEFAULT_QUOTA}</span></td>
                                   <td className="px-4 py-3 text-right flex justify-end gap-2 opacity-60 group-hover:opacity-100 transition-opacity">
                                       <button onClick={() => setEditingEmployee(emp)} className="text-indigo-400 hover:text-indigo-600 p-1.5 hover:bg-indigo-50 rounded-lg transition-colors"><Edit3 size={16} /></button>
                                       <button onClick={() => handleDeleteEmployee(emp.id)} className="text-red-400 hover:text-red-600 p-1.5 hover:bg-red-50 rounded-lg transition-colors"><Trash2 size={16} /></button>
                                   </td>
                                </tr>
                             ))}
                          </tbody>
                       </table>
                    </div>
                 </div>
                 <div className="mt-8 pt-6 border-t border-slate-50 flex justify-end">
                    <button onClick={handleResetSystem} className="text-slate-400 text-xs flex items-center gap-1 hover:text-red-500 transition-colors"><RefreshCw size={12} /> รีเซ็ตข้อมูลระบบ (ล้างค่าทั้งหมด)</button>
                 </div>
              </Card>
            </div>
        );

        // --- Main Application ---
        function App() {
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [view, setView] = useState('dashboard'); 
          const [role, setRole] = useState('guest'); 
          const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
          const [toast, setToast] = useState(null); 
          
          // Data States
          const [partnerships, setPartnerships] = useState(() => JSON.parse(localStorage.getItem('partnerships') || JSON.stringify(MOCK_PARTNERSHIPS)));
          const [employees, setEmployees] = useState(() => JSON.parse(localStorage.getItem('employees') || JSON.stringify(MOCK_EMPLOYEES)));
          const [leaveRecords, setLeaveRecords] = useState(() => JSON.parse(localStorage.getItem('leaveRecords') || JSON.stringify(MOCK_LEAVES)));
          const [attendanceRecords, setAttendanceRecords] = useState(() => JSON.parse(localStorage.getItem('attendanceRecords') || '[]'));

          // UI States
          const [selectedPartnershipId, setSelectedPartnershipId] = useState('all');
          const [dateFilter, setDateFilter] = useState('this_month'); 
          const [dashboardTab, setDashboardTab] = useState('overview'); 
          const [searchTerm, setSearchTerm] = useState(''); 
          const [employeeSearch, setEmployeeSearch] = useState('');
          
          // Form States
          const [newLeave, setNewLeave] = useState({ empId: '', type: 'ลากิจ', days: 1, date: '', reason: '', hasCertificate: false });
          const [newEmp, setNewEmp] = useState({ name: '', position: '', partnershipId: '', quota: DEFAULT_QUOTA });
          const [editingName, setEditingName] = useState({ id: null, name: '' });
          const [editingEmployee, setEditingEmployee] = useState(null);

          // --- Effects ---
          useEffect(() => { localStorage.setItem('partnerships', JSON.stringify(partnerships)); }, [partnerships]);
          useEffect(() => { localStorage.setItem('employees', JSON.stringify(employees)); }, [employees]);
          useEffect(() => { localStorage.setItem('leaveRecords', JSON.stringify(leaveRecords)); }, [leaveRecords]);
          useEffect(() => { localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords)); }, [attendanceRecords]);

          // --- Auth Logic ---
          const handleLogin = (userRole) => {
              setIsAuthenticated(true);
              setRole(userRole);
              if (userRole === 'super_admin') {
                  setView('dashboard');
                  setSelectedPartnershipId('all');
              } else {
                  setView('entry');
              }
          };

          const handleLogout = () => {
              setIsAuthenticated(false);
              setRole('guest');
              setView('dashboard');
          };

          // --- Actions ---
          const handleAddLeave = (e) => { e.preventDefault(); if (!newLeave.empId || !newLeave.date) { setToast({ message: 'กรุณากรอกข้อมูล', type: 'error' }); return; } const record = { ...newLeave, id: Date.now(), status: 'Approved', timestamp: new Date().toISOString() }; setLeaveRecords(prev => [record, ...prev]); setToast({ message: 'บันทึกสำเร็จ', type: 'success' }); setNewLeave({ ...newLeave, type: 'ลากิจ', days: 1, reason: '', hasCertificate: false }); };
          const handleDeleteLeave = (id) => { if (window.confirm('ลบรายการ?')) { setLeaveRecords(prev => prev.filter(r => r.id !== id)); setToast({ message: 'ลบสำเร็จ', type: 'success' }); }};
          const handleAddEmployee = (e) => { e.preventDefault(); if (!newEmp.name || !newEmp.partnershipId) return; setEmployees(prev => [...prev, { ...newEmp, id: Date.now(), partnershipId: Number(newEmp.partnershipId), quota: Number(newEmp.quota) || DEFAULT_QUOTA }]); setNewEmp({ name: '', position: '', partnershipId: '', quota: DEFAULT_QUOTA }); setToast({ message: 'เพิ่มพนักงานสำเร็จ', type: 'success' }); };
          const handleUpdateEmployee = () => { if (!editingEmployee || !editingEmployee.name) return; setEmployees(prev => prev.map(e => e.id === editingEmployee.id ? editingEmployee : e)); setEditingEmployee(null); setToast({ message: 'แก้ไขสำเร็จ', type: 'success' }); };
          const handleDeleteEmployee = (id) => { if (window.confirm('ยืนยันลบพนักงาน?')) { setEmployees(prev => prev.filter(e => e.id !== id)); setLeaveRecords(prev => prev.filter(r => r.empId !== id)); setToast({ message: 'ลบสำเร็จ', type: 'success' }); }};
          const handleUpdatePartnershipName = (id) => { setPartnerships(prev => prev.map(p => p.id === id ? { ...p, name: editingName.name } : p)); setEditingName({ id: null, name: '' }); setToast({ message: 'อัปเดตสำเร็จ', type: 'success' }); };
          const handleGenerateData = () => { if (window.confirm('สร้างข้อมูลทดสอบ? (ข้อมูลเดิมจะหาย)')) { setPartnerships(MOCK_PARTNERSHIPS); setEmployees(MOCK_EMPLOYEES); setLeaveRecords(MOCK_LEAVES); setToast({ message: 'สร้างข้อมูลสำเร็จ', type: 'success' }); }};
          const handleResetSystem = () => { if (window.confirm('ล้างข้อมูลทั้งหมด?')) { localStorage.clear(); window.location.reload(); }};
          const handleExportJSON = () => { const data = { partnerships, employees, leaveRecords, attendanceRecords }; const blob = new Blob([JSON.stringify(data)], { type: 'application/json' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = 'hr_backup.json'; document.body.appendChild(link); link.click(); link.remove(); setToast({ message: 'Backup เรียบร้อย', type: 'success' }); };
          const handleExportCSV = () => { let csv = "Date,Name,Partnership,Type,Days,Status\n" + leaveRecords.map(r => { const emp = employees.find(e => e.id === r.empId); const part = partnerships.find(p => p.id === emp?.partnershipId); return `${r.date},${emp?.name},${part?.name},${r.type},${r.days},${r.status}`; }).join('\n'); const link = document.createElement("a"); link.href = encodeURI("data:text/csv;charset=utf-8,\uFEFF" + csv); link.download = "leave_report.csv"; document.body.appendChild(link); link.click(); link.remove(); setToast({ message: 'Download สำเร็จ', type: 'success' }); };
          
          const handleImportAttendance = (e) => {
            const file = e.target.files?.[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
              const lines = (ev.target?.result).split('\n');
              const newRecs = [];
              lines.forEach((l, i) => {
                const [n, d, t] = l.split(',').map(s => s.trim());
                const emp = employees.find(em => em.name === n);
                if (emp && d && t) {
                    const late = calculateLateMinutes(t);
                    if (late > 0) newRecs.push({ id: Date.now() + i, empId: emp.id, date: d, timeIn: t, lateMinutes: late });
                }
              });
              if(newRecs.length > 0) { setAttendanceRecords(p => [...p, ...newRecs]); setToast({message: `นำเข้า ${newRecs.length} รายการ`, type: 'success'}); }
            };
            reader.readAsText(file);
            e.target.value = '';
          };

          const getEmpUsage = (id) => leaveRecords.filter(r => Number(r.empId) === id && r.status === 'Approved').reduce((acc, r) => acc + Number(r.days), 0);
          const getEmpQuota = (id) => employees.find(e => e.id === id)?.quota || DEFAULT_QUOTA;

          // --- Compute Late Stats ---
          const lateStats = useMemo(() => {
            let pid = selectedPartnershipId;
            if (role === 'staff_hr') pid = 101; if (role === 'staff_kk') pid = 102;
            let recs = attendanceRecords;
            if (pid !== 'all') { const ids = employees.filter(e => e.partnershipId === Number(pid)).map(e => e.id); recs = recs.filter(r => ids.includes(r.empId)); }
            const grouped = {};
            recs.forEach(r => {
                if (!grouped[r.empId]) grouped[r.empId] = { empId: r.empId, count: 0, totalMinutes: 0, lastDate: r.date, timeIn: r.timeIn };
                grouped[r.empId].count++; grouped[r.empId].totalMinutes += r.lateMinutes;
                if (new Date(r.date) > new Date(grouped[r.empId].lastDate)) { grouped[r.empId].lastDate = r.date; grouped[r.empId].timeIn = r.timeIn; }
            });
            return Object.values(grouped).map((i) => ({ ...i, employee: employees.find(e => e.id === i.empId) })).filter((i) => i.employee);
          }, [attendanceRecords, employees, selectedPartnershipId, role]);

          const filteredEmployeesSettings = useMemo(() => employees.filter(e => e.name.includes(employeeSearch)), [employees, employeeSearch]);
          
          // --- Data Processing ---
          const filteredRecords = useMemo(() => {
            let recs = leaveRecords;
            if (selectedPartnershipId !== 'all') { 
                const ids = employees.filter(e => e.partnershipId === Number(selectedPartnershipId)).map(e => e.id); 
                recs = recs.filter(r => ids.includes(r.empId)); 
            }
            if(searchTerm) recs = recs.filter(r => employees.find(e => e.id === r.empId)?.name.includes(searchTerm));
            
            // Add enrichment
            return recs.map(r => ({
                ...r,
                employeeName: employees.find(e => e.id === r.empId)?.name,
                partnershipName: partnerships.find(p => p.id === employees.find(e => e.id === r.empId)?.partnershipId)?.name
            }));
          }, [leaveRecords, selectedPartnershipId, searchTerm, employees, partnerships]);

          const stats = useMemo(() => {
            const total = leaveRecords.reduce((acc, r) => acc + Number(r.days), 0);
            const sick = leaveRecords.filter(r => r.type === 'ลาป่วย').reduce((acc, r) => acc + Number(r.days), 0);
            const vacation = leaveRecords.filter(r => r.type === 'พักร้อน').reduce((acc, r) => acc + Number(r.days), 0);
            return { total, sick, vacation };
          }, [leaveRecords]);

          const chartData = useMemo(() => ['ลาป่วย', 'ลากิจ', 'พักร้อน', 'อื่นๆ'].map(t => ({ name: t, value: leaveRecords.filter(r => r.type === t).reduce((acc, r) => acc + Number(r.days), 0) })), [leaveRecords]);
          
          const topLeavers = useMemo(() => {
              const m = {};
              leaveRecords.forEach(r => { m[r.empId] = (m[r.empId] || 0) + Number(r.days); });
              return Object.entries(m).map(([id, d]) => ({ employee: employees.find(e => e.id == Number(id)), days: d })).sort((a,b) => b.days - a.days);
          }, [leaveRecords, employees]);

          if (!isAuthenticated) {
              return <LoginView onLogin={handleLogin} />;
          }

          return (
            <div className={`min-h-screen bg-slate-50 font-sans text-slate-800 flex flex-col md:flex-row overflow-hidden`}>
              {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
              
              {/* Sidebar */}
              <aside className={`fixed z-50 h-full bg-white border-r border-slate-100 shadow-xl transition-all duration-300 ${mobileMenuOpen ? 'w-64 translate-x-0' : 'w-64 -translate-x-full md:translate-x-0'}`}>
                 <div className="p-8 pb-6 flex items-center gap-3">
                    <div className="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white font-bold shadow-lg shadow-red-200 text-xl">S</div>
                    <div>
                        <h1 className="text-lg font-extrabold text-slate-900 tracking-tight leading-none">SCG HEIM<span className="text-primary">.</span></h1>
                        <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">HR System</p>
                    </div>
                 </div>
                 
                 <nav className="flex-1 px-4 space-y-1 mt-4">
                    <NavItem active={view === 'dashboard'} onClick={() => { setView('dashboard'); setSelectedPartnershipId('all'); }} icon={LayoutDashboard} label="ภาพรวม" />
                    <NavItem active={view === 'entry'} onClick={() => { setView('entry'); }} icon={FileText} label="บันทึกวันลา" />
                    {role === 'super_admin' && <NavItem active={view === 'settings'} onClick={() => setView('settings')} icon={Settings} label="ตั้งค่าข้อมูล" />}
                 </nav>
                 
                 <div className="p-4 mt-auto border-t border-slate-50">
                    <div className="flex items-center gap-3 p-3 bg-slate-50 rounded-xl mb-2">
                        <div className={`w-10 h-10 rounded-full text-white flex items-center justify-center font-bold text-xs shadow-sm ${role === 'super_admin' ? 'bg-slate-800' : 'bg-slate-500'}`}>
                            {role === 'super_admin' ? 'AD' : 'HR'}
                        </div>
                        <div className="flex-1 min-w-0">
                            <p className="text-xs font-bold text-slate-800 truncate">
                                {role === 'super_admin' ? 'SCG Admin' : role === 'staff_hr' ? 'HR Staff' : 'KK Staff'}
                            </p>
                            <div className="flex items-center gap-1.5 mt-0.5">
                                <span className="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                                <p className="text-[10px] text-slate-500 font-medium">Online</p>
                            </div>
                        </div>
                    </div>
                    <button onClick={handleLogout} className="w-full flex items-center justify-center gap-2 p-2 text-xs text-red-500 hover:bg-red-50 rounded-lg transition-colors font-bold">
                        <LogOut size={14}/> ออกจากระบบ
                    </button>
                 </div>
              </aside>

              {/* Main Content */}
              <div className="flex-1 flex flex-col h-full relative md:ml-64 bg-slate-50/50">
                 {/* Top Navigation Bar */}
                 <header className="bg-white/80 backdrop-blur-md border-b border-slate-200/60 h-16 flex items-center justify-between px-8 sticky top-0 z-40">
                    <div className="flex items-center gap-4">
                        <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="md:hidden text-slate-500 hover:text-slate-800"><Menu/></button>
                        <h2 className="text-sm font-bold text-slate-400 uppercase tracking-wide hidden md:block">Human Resource Management</h2>
                    </div>
                    
                    {/* Role indicator (Replaces buttons) */}
                    <div className="flex items-center gap-2 bg-slate-100/50 p-1.5 px-3 rounded-xl border border-slate-200/50">
                       <span className="text-xs font-medium text-slate-500">สถานะผู้ใช้:</span>
                       <span className={`text-xs font-bold ${role === 'super_admin' ? 'text-primary' : role === 'staff_hr' ? 'text-blue-600' : 'text-emerald-600'}`}>
                           {role === 'super_admin' ? 'ผู้ดูแลระบบ (Admin)' : role === 'staff_hr' ? 'เจ้าหน้าที่ HR' : 'เจ้าหน้าที่ แก้วเกรียงไกร'}
                       </span>
                    </div>
                 </header>

                 <main className="flex-1 p-8 overflow-y-auto scroll-smooth">
                    {view === 'dashboard' && <DashboardView {...{ stats, chartData, filteredRecords, topLeavers, lateStats, dateFilter, setDateFilter, dashboardTab, setDashboardTab, handleExportCSV, searchTerm, setSearchTerm, handleDeleteLeave, role, partnerships, selectedPartnershipId, setSelectedPartnershipId, employees, leaveRecords }} />}
                    {view === 'entry' && <EntryView {...{ role, partnerships, employees, leaveRecords, newLeave, setNewLeave, handleAddLeave, getEmpUsage, handleDeleteLeave, getEmpQuota }} />}
                    {view === 'settings' && <SettingsView {...{ partnerships, employees, handleGenerateData, handleResetSystem, handleExportJSON, handleUpdatePartnershipName, handleAddEmployee, handleUpdateEmployee, handleDeleteEmployee, editingName, setEditingName, newEmp, setNewEmp, editingEmployee, setEditingEmployee, handleImportAttendance, employeeSearch, setEmployeeSearch, filteredEmployeesSettings }} />}
                 </main>
              </div>
              
              {mobileMenuOpen && <div className="fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-40 md:hidden" onClick={() => setMobileMenuOpen(false)}></div>}
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
